import{_ as s}from"./chunks/9olqLl7-x6XtWyNUssHvLGkRzM5cj2_KAPAYU4vaHIw.9541447f.js";import{_ as n,o as a,c as l,Q as p}from"./chunks/framework.e90f0c97.js";const A=JSON.parse('{"title":"7: å¾ªç¯ç¥ç»ç½‘ç»œå®æˆ˜é¡¹ç›®","description":"","frontmatter":{"prev":{"text":"6.å¾ªç¯ç¥ç»ç½‘ç»œç†è®º","link":"./6.å¾ªç¯ç¥ç»ç½‘ç»œç†è®º.md"},"next":{"text":"8.Transformer","link":"./8.Transformer.md"}},"headers":[],"relativePath":"md/æœºå™¨å­¦ä¹ /7.å¾ªç¯ç¥ç»ç½‘ç»œå®æˆ˜.md","filePath":"md/æœºå™¨å­¦ä¹ /7.å¾ªç¯ç¥ç»ç½‘ç»œå®æˆ˜.md"}'),o={name:"md/æœºå™¨å­¦ä¹ /7.å¾ªç¯ç¥ç»ç½‘ç»œå®æˆ˜.md"},e=p('<p><img src="'+s+`" alt="9olqLl7-x6XtWyNUssHvLGkRzM5cj2_KAPAYU4vaHIw"></p><h1 id="_7-å¾ªç¯ç¥ç»ç½‘ç»œå®æˆ˜é¡¹ç›®" tabindex="-1">7: å¾ªç¯ç¥ç»ç½‘ç»œå®æˆ˜é¡¹ç›® <a class="header-anchor" href="#_7-å¾ªç¯ç¥ç»ç½‘ç»œå®æˆ˜é¡¹ç›®" aria-label="Permalink to &quot;7: å¾ªç¯ç¥ç»ç½‘ç»œå®æˆ˜é¡¹ç›®&quot;">â€‹</a></h1><p>æ­å–œä½ ï¼ğŸ‰ åœ¨ç»è¿‡ä¸Šä¸€ä¸ªé¢˜ç›®çš„æ·±å…¥å­¦ä¹ åï¼Œä½ å·²ç»æˆåŠŸæŒæ¡äº†å¾ªç¯ç¥ç»ç½‘ç»œçš„æ ¸å¿ƒçŸ¥è¯†ã€‚ç°åœ¨æ˜¯æ—¶å€™å°†ç†è®ºä»˜è¯¸å®è·µï¼Œæ„å»ºä¸€ä¸ªçœŸæ­£èƒ½å¤Ÿç†è§£äººç±»æƒ…æ„Ÿçš„AIç³»ç»Ÿäº†ï¼</p><p>è¿™ä¸ªé¡¹ç›®å°†å¸¦ä½ ä»ç†è®ºèµ°å‘åº”ç”¨ï¼Œä½“éªŒAIå·¥ç¨‹å¸ˆçš„çœŸå®å·¥ä½œæµç¨‹â€”â€”ä»æ•°æ®å¤„ç†åˆ°æ¨¡å‹éƒ¨ç½²ã€‚å‡†å¤‡å¥½è¿æ¥æŒ‘æˆ˜äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹è¿™æ®µæ¿€åŠ¨äººå¿ƒçš„æ—…ç¨‹å§ï¼</p><blockquote><p>ğŸ’¡ <strong>é¡¹ç›®äº®ç‚¹</strong>ï¼šä½ å°†è¦æ„å»ºçš„æƒ…æ„Ÿåˆ†æç³»ç»Ÿï¼Œæ­£æ˜¯è®¸å¤šäº’è”ç½‘å…¬å¸ç”¨æ¥åˆ†æç”¨æˆ·è¯„è®ºã€ç¤¾äº¤åª’ä½“æƒ…ç»ªçš„æ ¸å¿ƒæŠ€æœ¯ï¼</p></blockquote><hr><h2 id="ğŸ“Š-æ•°æ®é›†å‡†å¤‡" tabindex="-1">ğŸ“Š æ•°æ®é›†å‡†å¤‡ <a class="header-anchor" href="#ğŸ“Š-æ•°æ®é›†å‡†å¤‡" aria-label="Permalink to &quot;ğŸ“Š æ•°æ®é›†å‡†å¤‡&quot;">â€‹</a></h2><h3 id="ä¸»æ•°æ®é›†" tabindex="-1">ä¸»æ•°æ®é›† <a class="header-anchor" href="#ä¸»æ•°æ®é›†" aria-label="Permalink to &quot;ä¸»æ•°æ®é›†&quot;">â€‹</a></h3><p><strong><a href="https://www.kaggle.com/datasets/pradeeshprabhakar/preprocessed-dataset-sentiment-analysis" target="_blank" rel="noreferrer">Preprocessed Dataset Sentiment Analysis</a></strong></p><h3 id="å¤‡é€‰æ•°æ®é›†-ä»»é€‰å…¶ä¸€" tabindex="-1">å¤‡é€‰æ•°æ®é›†ï¼ˆä»»é€‰å…¶ä¸€ï¼‰ <a class="header-anchor" href="#å¤‡é€‰æ•°æ®é›†-ä»»é€‰å…¶ä¸€" aria-label="Permalink to &quot;å¤‡é€‰æ•°æ®é›†ï¼ˆä»»é€‰å…¶ä¸€ï¼‰&quot;">â€‹</a></h3><ul><li><a href="https://www.kaggle.com/datasets/marklvl/sentiment-labelled-sentences-data-set" target="_blank" rel="noreferrer">Sentiment Labelled Sentences Data Set</a></li><li><a href="https://www.kaggle.com/datasets/abhi8923shriv/sentiment-analysis-dataset" target="_blank" rel="noreferrer">Sentiment Analysis Dataset</a></li></ul><blockquote><p><strong>æ•°æ®é›†è¯´æ˜</strong>ï¼šè¿™äº›éƒ½æ˜¯ç»è¿‡ç²¾å¿ƒç­›é€‰çš„çœŸå®æ–‡æœ¬æ•°æ®ï¼ŒåŒ…å«äº†ä¸°å¯Œçš„æƒ…æ„Ÿè¡¨è¾¾ï¼Œæ˜¯è®­ç»ƒæƒ…æ„Ÿåˆ†ææ¨¡å‹çš„ç»ä½³ç´ æï¼</p></blockquote><hr><h2 id="ğŸ¯-é¡¹ç›®ä»»åŠ¡" tabindex="-1">ğŸ¯ é¡¹ç›®ä»»åŠ¡ <a class="header-anchor" href="#ğŸ¯-é¡¹ç›®ä»»åŠ¡" aria-label="Permalink to &quot;ğŸ¯ é¡¹ç›®ä»»åŠ¡&quot;">â€‹</a></h2><h3 id="æ ¸å¿ƒç›®æ ‡" tabindex="-1">æ ¸å¿ƒç›®æ ‡ <a class="header-anchor" href="#æ ¸å¿ƒç›®æ ‡" aria-label="Permalink to &quot;æ ¸å¿ƒç›®æ ‡&quot;">â€‹</a></h3><p>åŸºäºå·²æ¸…æ´—çš„æ–‡æœ¬æ•°æ®ï¼Œè®¾è®¡å¹¶å®ç°ä¸€ä¸ª<strong>æ™ºèƒ½æƒ…æ„Ÿåˆ†ç±»ç³»ç»Ÿ</strong>ï¼Œèƒ½å¤Ÿå‡†ç¡®è¯†åˆ«æ–‡æœ¬ä¸­çš„æƒ…æ„Ÿå€¾å‘ï¼ˆæ­£é¢ã€è´Ÿé¢ã€ä¸­æ€§ï¼‰ã€‚</p><p>æƒ³è±¡ä¸€ä¸‹ï¼šå½“ç”¨æˆ·åœ¨ç”µå•†å¹³å°å†™ä¸‹ä¸€æ¡è¯„è®ºï¼Œæˆ–è€…åœ¨ç¤¾äº¤åª’ä½“å‘è¡¨ä¸€ä¸ªçŠ¶æ€æ—¶ï¼Œä½ çš„ç³»ç»Ÿèƒ½å¤Ÿç¬é—´ç†è§£å…¶ä¸­çš„æƒ…æ„Ÿè‰²å½©â€”â€”è¿™å°±æ˜¯AIçš„é­…åŠ›æ‰€åœ¨ï¼âœ¨</p><hr><h2 id="ğŸ“‹-é¡¹ç›®è¦æ±‚" tabindex="-1">ğŸ“‹ é¡¹ç›®è¦æ±‚ <a class="header-anchor" href="#ğŸ“‹-é¡¹ç›®è¦æ±‚" aria-label="Permalink to &quot;ğŸ“‹ é¡¹ç›®è¦æ±‚&quot;">â€‹</a></h2><h3 id="æ ¸å¿ƒå®ç°è¦æ±‚-å±•ç°ä½ çš„ç¡¬æ ¸å®åŠ›" tabindex="-1">æ ¸å¿ƒå®ç°è¦æ±‚ï¼ˆå±•ç°ä½ çš„ç¡¬æ ¸å®åŠ›ï¼ï¼‰ <a class="header-anchor" href="#æ ¸å¿ƒå®ç°è¦æ±‚-å±•ç°ä½ çš„ç¡¬æ ¸å®åŠ›" aria-label="Permalink to &quot;æ ¸å¿ƒå®ç°è¦æ±‚ï¼ˆå±•ç°ä½ çš„ç¡¬æ ¸å®åŠ›ï¼ï¼‰&quot;">â€‹</a></h3><ol><li><strong>æ•°æ®ç†è§£</strong><ul><li>ä½¿ç”¨æä¾›çš„æ•°æ®å¤„ç†ä»£ç ï¼Œæ·±å…¥ç†è§£æ•°æ®å¤„ç†æµç¨‹</li><li>æŒæ¡ä»åŸå§‹æ–‡æœ¬åˆ°æ¨¡å‹è¾“å…¥çš„å®Œæ•´è½¬æ¢è¿‡ç¨‹</li></ul></li><li><strong>æ¨¡å‹æ„å»º</strong><ul><li><strong>æ‰‹åŠ¨æ­å»ºåŒå‘LSTMæ¨¡å‹</strong>ï¼ˆå±•ç°ä½ çš„æ·±åº¦å­¦ä¹ åŠŸåº•ï¼ï¼‰</li><li>åªèƒ½ä½¿ç”¨<code>PyTorch</code>çš„åŸºç¡€åº“å‡½æ•°å¦‚<code>nn.LSTM</code>ç­‰</li><li>âš ï¸ <strong>é‡è¦</strong>ï¼šè¿™éƒ¨åˆ†è¯·ç‹¬ç«‹å®Œæˆï¼Œä¸è¦ç›´æ¥ä½¿ç”¨AIç¼–å†™ä»£ç ï¼</li></ul></li><li><strong>è®­ç»ƒå®ç°</strong><ul><li><strong>æ‰‹åŠ¨å®ç°å®Œæ•´è®­ç»ƒå¾ªç¯</strong>ï¼ˆåŒ…æ‹¬å‰å‘ä¼ æ’­ã€æŸå¤±è®¡ç®—ã€åå‘ä¼ æ’­ï¼‰</li><li>è¿™å°†è®©ä½ çœŸæ­£ç†è§£æ·±åº¦å­¦ä¹ è®­ç»ƒçš„æ¯ä¸€ä¸ªç»†èŠ‚</li><li>âš ï¸ <strong>é‡è¦</strong>ï¼šè¿™éƒ¨åˆ†ä¹Ÿè¯·ç‹¬ç«‹å®Œæˆï¼Œä½“éªŒçœŸæ­£çš„AIå·¥ç¨‹å¸ˆå·¥ä½œï¼</li></ul></li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong><ul><li>æ”¹è¿›æ¨¡å‹æ€§èƒ½ï¼ˆè¿™é‡Œå¯ä»¥<strong>éšæ„å‘æŒ¥ï¼Œéšæ„è°ƒç”¨åº“å‡½æ•°</strong>ï¼ï¼‰</li><li><strong>ç›®æ ‡æŒ‘æˆ˜</strong>ï¼šå‡†ç¡®ç‡è¾¾åˆ°85%ä»¥ä¸Š</li><li>ğŸ’ª <strong>æå‡ç©ºé—´</strong>ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œå¯ä»¥é€‚åº¦ä½¿ç”¨AIå·¥å…·æ¥æ¢ç´¢æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ</li></ul></li></ol><blockquote><p>ğŸ¯ <strong>å­¦ä¹ ç­–ç•¥</strong>ï¼šå‰ä¸¤ä¸ªè¦æ±‚è®©ä½ æ·±å…¥ç†è§£åŸç†ï¼Œæœ€åä¸€ä¸ªè¦æ±‚è®©ä½ ä½“éªŒå·¥ç¨‹ä¼˜åŒ–çš„ä¹è¶£ï¼</p></blockquote><hr><h2 id="ğŸ› ï¸-æä¾›çš„å¼ºåŠ›è¾…åŠ©å·¥å…·" tabindex="-1">ğŸ› ï¸ æä¾›çš„å¼ºåŠ›è¾…åŠ©å·¥å…· <a class="header-anchor" href="#ğŸ› ï¸-æä¾›çš„å¼ºåŠ›è¾…åŠ©å·¥å…·" aria-label="Permalink to &quot;ğŸ› ï¸ æä¾›çš„å¼ºåŠ›è¾…åŠ©å·¥å…·&quot;">â€‹</a></h2><p>æˆ‘ä»¬ä¸ºä½ å‡†å¤‡äº†å®Œæ•´çš„æ•°æ®å¤„ç†å’Œè¯„ä¼°å·¥å…·åŒ…ï¼Œè®©ä½ ä¸“æ³¨äºæ ¸å¿ƒçš„æ¨¡å‹å®ç°ï¼</p><h3 id="_1ï¸âƒ£-æ•°æ®å¤„ç†æ¨¡å—-å·²æä¾›å®Œæ•´å®ç°" tabindex="-1">1ï¸âƒ£ æ•°æ®å¤„ç†æ¨¡å—ï¼ˆå·²æä¾›å®Œæ•´å®ç°ï¼‰ <a class="header-anchor" href="#_1ï¸âƒ£-æ•°æ®å¤„ç†æ¨¡å—-å·²æä¾›å®Œæ•´å®ç°" aria-label="Permalink to &quot;1ï¸âƒ£ æ•°æ®å¤„ç†æ¨¡å—ï¼ˆå·²æä¾›å®Œæ•´å®ç°ï¼‰&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> pandas </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> pd</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> numpy </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> np</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> torch</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> torch.utils.data </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Dataset, DataLoader</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> collections </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Counter</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> re</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DataProcessor</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">__init__</span><span style="color:#E1E4E8;">(self, max_vocab_size</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">10000</span><span style="color:#E1E4E8;">, max_seq_length</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">128</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.max_vocab_size </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> max_vocab_size</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.max_seq_length </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> max_seq_length</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.word2idx </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span><span style="color:#9ECBFF;">&#39;&lt;PAD&gt;&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;&lt;UNK&gt;&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.idx2word </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;&lt;PAD&gt;&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;&lt;UNK&gt;&#39;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">clean_text</span><span style="color:#E1E4E8;">(self, text):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;&quot;&quot;ç®€å•æ–‡æœ¬æ¸…æ´—&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        text </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> re.sub(</span><span style="color:#F97583;">r</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#79B8FF;">[</span><span style="color:#F97583;">^</span><span style="color:#79B8FF;">a-zA-Z\\s]</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">str</span><span style="color:#E1E4E8;">(text).lower())</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> text.strip()</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">build_vocabulary</span><span style="color:#E1E4E8;">(self, texts):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;&quot;&quot;æ„å»ºè¯æ±‡è¡¨ - åªåœ¨è®­ç»ƒé›†ä¸Šè°ƒç”¨&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        word_counts </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Counter()</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> text </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> texts:</span></span>
<span class="line"><span style="color:#E1E4E8;">            words </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> text.split()</span></span>
<span class="line"><span style="color:#E1E4E8;">            word_counts.update(words)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># é€‰æ‹©æœ€å¸¸è§çš„è¯</span></span>
<span class="line"><span style="color:#E1E4E8;">        most_common </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> word_counts.most_common(</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.max_vocab_size </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> i, (word, _) </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">enumerate</span><span style="color:#E1E4E8;">(most_common):</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.word2idx[word] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.idx2word[i </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> word</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">print</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">f</span><span style="color:#9ECBFF;">&quot;è¯æ±‡è¡¨å¤§å°: </span><span style="color:#79B8FF;">{len</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.word2idx)</span><span style="color:#79B8FF;">}</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">text_to_sequence</span><span style="color:#E1E4E8;">(self, text):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;&quot;&quot;æ–‡æœ¬è½¬åºåˆ—&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        words </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> text.split()</span></span>
<span class="line"><span style="color:#E1E4E8;">        sequence </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.word2idx.get(word, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> word </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> words]  </span><span style="color:#6A737D;"># 1æ˜¯&lt;UNK&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> sequence</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pad_sequences</span><span style="color:#E1E4E8;">(self, sequences):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;&quot;&quot;åºåˆ—å¡«å……&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        padded </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> []</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> seq </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> sequences:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">len</span><span style="color:#E1E4E8;">(seq) </span><span style="color:#F97583;">&gt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.max_seq_length:</span></span>
<span class="line"><span style="color:#E1E4E8;">                padded.append(seq[:</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.max_seq_length])</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                padded.append(seq </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.max_seq_length </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">len</span><span style="color:#E1E4E8;">(seq)))</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> np.array(padded)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">prepare_data</span><span style="color:#E1E4E8;">(self, texts, labels, build_vocab</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;&quot;&quot;å‡†å¤‡è®­ç»ƒæ•°æ®&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># æ¸…æ´—æ–‡æœ¬</span></span>
<span class="line"><span style="color:#E1E4E8;">        cleaned_texts </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.clean_text(text) </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> text </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> texts]</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># åªåœ¨éœ€è¦æ—¶æ„å»ºè¯æ±‡è¡¨ï¼ˆé€šå¸¸åªåœ¨è®­ç»ƒé›†ä¸Šï¼‰</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> build_vocab:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.build_vocabulary(cleaned_texts)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># è½¬æ¢ä¸ºåºåˆ—</span></span>
<span class="line"><span style="color:#E1E4E8;">        sequences </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.text_to_sequence(text) </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> text </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> cleaned_texts]</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># å¡«å……åºåˆ—</span></span>
<span class="line"><span style="color:#E1E4E8;">        padded_sequences </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.pad_sequences(sequences)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> padded_sequences, np.array(labels)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">transform_data</span><span style="color:#E1E4E8;">(self, texts, labels):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;&quot;&quot;è½¬æ¢æ•°æ®ï¼ˆä¸æ„å»ºè¯æ±‡è¡¨ï¼‰- ç”¨äºéªŒè¯é›†å’Œæµ‹è¯•é›†&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># æ¸…æ´—æ–‡æœ¬</span></span>
<span class="line"><span style="color:#E1E4E8;">        cleaned_texts </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.clean_text(text) </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> text </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> texts]</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># è½¬æ¢ä¸ºåºåˆ—</span></span>
<span class="line"><span style="color:#E1E4E8;">        sequences </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.text_to_sequence(text) </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> text </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> cleaned_texts]</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># å¡«å……åºåˆ—</span></span>
<span class="line"><span style="color:#E1E4E8;">        padded_sequences </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.pad_sequences(sequences)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> padded_sequences, np.array(labels)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SentimentDataset</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Dataset</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">__init__</span><span style="color:#E1E4E8;">(self, texts, labels):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.texts </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> torch.LongTensor(texts)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.labels </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> torch.LongTensor(labels)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">__len__</span><span style="color:#E1E4E8;">(self):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">len</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.texts)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">__getitem__</span><span style="color:#E1E4E8;">(self, idx):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.texts[idx], </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.labels[idx]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">load_and_prepare_data</span><span style="color:#E1E4E8;">(file_path):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;åŠ è½½å¹¶å‡†å¤‡æ•°æ®&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># æ ¹æ®ä¸åŒæ•°æ®é›†è°ƒæ•´è¯»å–æ–¹å¼</span></span>
<span class="line"><span style="color:#E1E4E8;">    df </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> pd.read_csv(file_path)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># å‡è®¾åˆ—åä¸º &#39;text&#39; å’Œ &#39;label&#39;ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´</span></span>
<span class="line"><span style="color:#E1E4E8;">    texts </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> df[</span><span style="color:#9ECBFF;">&#39;text&#39;</span><span style="color:#E1E4E8;">].values</span></span>
<span class="line"><span style="color:#E1E4E8;">    labels </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> df[</span><span style="color:#9ECBFF;">&#39;label&#39;</span><span style="color:#E1E4E8;">].values</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># å°†æ ‡ç­¾è½¬æ¢ä¸ºæ•°å­—ï¼ˆå¦‚æœéœ€è¦ï¼‰</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> labels.dtype </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;object&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        unique_labels </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">list</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">set</span><span style="color:#E1E4E8;">(labels))</span></span>
<span class="line"><span style="color:#E1E4E8;">        label_to_idx </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {label: idx </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> idx, label </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">enumerate</span><span style="color:#E1E4E8;">(unique_labels)}</span></span>
<span class="line"><span style="color:#E1E4E8;">        labels </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [label_to_idx[label] </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> label </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> labels]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> texts, labels</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">create_data_loaders</span><span style="color:#E1E4E8;">(texts, labels, batch_size</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;">, test_size</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0.2</span><span style="color:#E1E4E8;">, val_size</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0.1</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;åˆ›å»ºæ•°æ®åŠ è½½å™¨&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> sklearn.model_selection </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> train_test_split</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># æ•°æ®åˆ†å‰²</span></span>
<span class="line"><span style="color:#E1E4E8;">    X_temp, X_test, y_temp, y_test </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> train_test_split(</span></span>
<span class="line"><span style="color:#E1E4E8;">        texts, labels, </span><span style="color:#FFAB70;">test_size</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">test_size, </span><span style="color:#FFAB70;">random_state</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">42</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">stratify</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">labels</span></span>
<span class="line"><span style="color:#E1E4E8;">    )</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    X_train, X_val, y_train, y_val </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> train_test_split(</span></span>
<span class="line"><span style="color:#E1E4E8;">        X_temp, y_temp, </span><span style="color:#FFAB70;">test_size</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">val_size</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">test_size), </span><span style="color:#FFAB70;">random_state</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">42</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">stratify</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">y_temp</span></span>
<span class="line"><span style="color:#E1E4E8;">    )</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># å¤„ç†æ•°æ® - åªåœ¨è®­ç»ƒé›†ä¸Šæ„å»ºè¯æ±‡è¡¨</span></span>
<span class="line"><span style="color:#E1E4E8;">    processor </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> DataProcessor()</span></span>
<span class="line"><span style="color:#E1E4E8;">    X_train_processed, y_train_processed </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> processor.prepare_data(X_train, y_train, </span><span style="color:#FFAB70;">build_vocab</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    X_val_processed, y_val_processed </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> processor.transform_data(X_val, y_val)</span></span>
<span class="line"><span style="color:#E1E4E8;">    X_test_processed, y_test_processed </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> processor.transform_data(X_test, y_test)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># åˆ›å»ºæ•°æ®é›†</span></span>
<span class="line"><span style="color:#E1E4E8;">    train_dataset </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> SentimentDataset(X_train_processed, y_train_processed)</span></span>
<span class="line"><span style="color:#E1E4E8;">    val_dataset </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> SentimentDataset(X_val_processed, y_val_processed)</span></span>
<span class="line"><span style="color:#E1E4E8;">    test_dataset </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> SentimentDataset(X_test_processed, y_test_processed)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># åˆ›å»ºæ•°æ®åŠ è½½å™¨</span></span>
<span class="line"><span style="color:#E1E4E8;">    train_loader </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> DataLoader(train_dataset, </span><span style="color:#FFAB70;">batch_size</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">batch_size, </span><span style="color:#FFAB70;">shuffle</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    val_loader </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> DataLoader(val_dataset, </span><span style="color:#FFAB70;">batch_size</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">batch_size, </span><span style="color:#FFAB70;">shuffle</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">False</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    test_loader </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> DataLoader(test_dataset, </span><span style="color:#FFAB70;">batch_size</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">batch_size, </span><span style="color:#FFAB70;">shuffle</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">False</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> train_loader, val_loader, test_loader, processor</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> pandas </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> pd</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> numpy </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> np</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> torch</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> torch.utils.data </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Dataset, DataLoader</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> collections </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Counter</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> re</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DataProcessor</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">__init__</span><span style="color:#24292E;">(self, max_vocab_size</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">10000</span><span style="color:#24292E;">, max_seq_length</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">128</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.max_vocab_size </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> max_vocab_size</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.max_seq_length </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> max_seq_length</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.word2idx </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span><span style="color:#032F62;">&#39;&lt;PAD&gt;&#39;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;&lt;UNK&gt;&#39;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.idx2word </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;&lt;PAD&gt;&#39;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;&lt;UNK&gt;&#39;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">clean_text</span><span style="color:#24292E;">(self, text):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;&quot;&quot;ç®€å•æ–‡æœ¬æ¸…æ´—&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        text </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> re.sub(</span><span style="color:#D73A49;">r</span><span style="color:#032F62;">&#39;</span><span style="color:#005CC5;">[</span><span style="color:#D73A49;">^</span><span style="color:#005CC5;">a-zA-Z\\s]</span><span style="color:#032F62;">&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;&#39;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">str</span><span style="color:#24292E;">(text).lower())</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> text.strip()</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">build_vocabulary</span><span style="color:#24292E;">(self, texts):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;&quot;&quot;æ„å»ºè¯æ±‡è¡¨ - åªåœ¨è®­ç»ƒé›†ä¸Šè°ƒç”¨&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        word_counts </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Counter()</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> text </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> texts:</span></span>
<span class="line"><span style="color:#24292E;">            words </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> text.split()</span></span>
<span class="line"><span style="color:#24292E;">            word_counts.update(words)</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># é€‰æ‹©æœ€å¸¸è§çš„è¯</span></span>
<span class="line"><span style="color:#24292E;">        most_common </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> word_counts.most_common(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.max_vocab_size </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> i, (word, _) </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">enumerate</span><span style="color:#24292E;">(most_common):</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.word2idx[word] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.idx2word[i </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> word</span></span>
<span class="line"><span style="color:#24292E;">            </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">f</span><span style="color:#032F62;">&quot;è¯æ±‡è¡¨å¤§å°: </span><span style="color:#005CC5;">{len</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.word2idx)</span><span style="color:#005CC5;">}</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">text_to_sequence</span><span style="color:#24292E;">(self, text):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;&quot;&quot;æ–‡æœ¬è½¬åºåˆ—&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        words </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> text.split()</span></span>
<span class="line"><span style="color:#24292E;">        sequence </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.word2idx.get(word, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> word </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> words]  </span><span style="color:#6A737D;"># 1æ˜¯&lt;UNK&gt;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> sequence</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pad_sequences</span><span style="color:#24292E;">(self, sequences):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;&quot;&quot;åºåˆ—å¡«å……&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        padded </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> []</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> seq </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> sequences:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">len</span><span style="color:#24292E;">(seq) </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.max_seq_length:</span></span>
<span class="line"><span style="color:#24292E;">                padded.append(seq[:</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.max_seq_length])</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">else</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                padded.append(seq </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.max_seq_length </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">len</span><span style="color:#24292E;">(seq)))</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> np.array(padded)</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">prepare_data</span><span style="color:#24292E;">(self, texts, labels, build_vocab</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;&quot;&quot;å‡†å¤‡è®­ç»ƒæ•°æ®&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># æ¸…æ´—æ–‡æœ¬</span></span>
<span class="line"><span style="color:#24292E;">        cleaned_texts </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.clean_text(text) </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> text </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> texts]</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># åªåœ¨éœ€è¦æ—¶æ„å»ºè¯æ±‡è¡¨ï¼ˆé€šå¸¸åªåœ¨è®­ç»ƒé›†ä¸Šï¼‰</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> build_vocab:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.build_vocabulary(cleaned_texts)</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># è½¬æ¢ä¸ºåºåˆ—</span></span>
<span class="line"><span style="color:#24292E;">        sequences </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.text_to_sequence(text) </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> text </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> cleaned_texts]</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># å¡«å……åºåˆ—</span></span>
<span class="line"><span style="color:#24292E;">        padded_sequences </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.pad_sequences(sequences)</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> padded_sequences, np.array(labels)</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">transform_data</span><span style="color:#24292E;">(self, texts, labels):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;&quot;&quot;è½¬æ¢æ•°æ®ï¼ˆä¸æ„å»ºè¯æ±‡è¡¨ï¼‰- ç”¨äºéªŒè¯é›†å’Œæµ‹è¯•é›†&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># æ¸…æ´—æ–‡æœ¬</span></span>
<span class="line"><span style="color:#24292E;">        cleaned_texts </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.clean_text(text) </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> text </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> texts]</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># è½¬æ¢ä¸ºåºåˆ—</span></span>
<span class="line"><span style="color:#24292E;">        sequences </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.text_to_sequence(text) </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> text </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> cleaned_texts]</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># å¡«å……åºåˆ—</span></span>
<span class="line"><span style="color:#24292E;">        padded_sequences </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.pad_sequences(sequences)</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> padded_sequences, np.array(labels)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SentimentDataset</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">Dataset</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">__init__</span><span style="color:#24292E;">(self, texts, labels):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.texts </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> torch.LongTensor(texts)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.labels </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> torch.LongTensor(labels)</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">__len__</span><span style="color:#24292E;">(self):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">len</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.texts)</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">__getitem__</span><span style="color:#24292E;">(self, idx):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.texts[idx], </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.labels[idx]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">load_and_prepare_data</span><span style="color:#24292E;">(file_path):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;åŠ è½½å¹¶å‡†å¤‡æ•°æ®&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># æ ¹æ®ä¸åŒæ•°æ®é›†è°ƒæ•´è¯»å–æ–¹å¼</span></span>
<span class="line"><span style="color:#24292E;">    df </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pd.read_csv(file_path)</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># å‡è®¾åˆ—åä¸º &#39;text&#39; å’Œ &#39;label&#39;ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´</span></span>
<span class="line"><span style="color:#24292E;">    texts </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> df[</span><span style="color:#032F62;">&#39;text&#39;</span><span style="color:#24292E;">].values</span></span>
<span class="line"><span style="color:#24292E;">    labels </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> df[</span><span style="color:#032F62;">&#39;label&#39;</span><span style="color:#24292E;">].values</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># å°†æ ‡ç­¾è½¬æ¢ä¸ºæ•°å­—ï¼ˆå¦‚æœéœ€è¦ï¼‰</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> labels.dtype </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;object&#39;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        unique_labels </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">list</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">set</span><span style="color:#24292E;">(labels))</span></span>
<span class="line"><span style="color:#24292E;">        label_to_idx </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {label: idx </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> idx, label </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">enumerate</span><span style="color:#24292E;">(unique_labels)}</span></span>
<span class="line"><span style="color:#24292E;">        labels </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [label_to_idx[label] </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> label </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> labels]</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> texts, labels</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">create_data_loaders</span><span style="color:#24292E;">(texts, labels, batch_size</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">32</span><span style="color:#24292E;">, test_size</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0.2</span><span style="color:#24292E;">, val_size</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0.1</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;åˆ›å»ºæ•°æ®åŠ è½½å™¨&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> sklearn.model_selection </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> train_test_split</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># æ•°æ®åˆ†å‰²</span></span>
<span class="line"><span style="color:#24292E;">    X_temp, X_test, y_temp, y_test </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> train_test_split(</span></span>
<span class="line"><span style="color:#24292E;">        texts, labels, </span><span style="color:#E36209;">test_size</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">test_size, </span><span style="color:#E36209;">random_state</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">42</span><span style="color:#24292E;">, </span><span style="color:#E36209;">stratify</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">labels</span></span>
<span class="line"><span style="color:#24292E;">    )</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    X_train, X_val, y_train, y_val </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> train_test_split(</span></span>
<span class="line"><span style="color:#24292E;">        X_temp, y_temp, </span><span style="color:#E36209;">test_size</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">val_size</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">test_size), </span><span style="color:#E36209;">random_state</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">42</span><span style="color:#24292E;">, </span><span style="color:#E36209;">stratify</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">y_temp</span></span>
<span class="line"><span style="color:#24292E;">    )</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># å¤„ç†æ•°æ® - åªåœ¨è®­ç»ƒé›†ä¸Šæ„å»ºè¯æ±‡è¡¨</span></span>
<span class="line"><span style="color:#24292E;">    processor </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> DataProcessor()</span></span>
<span class="line"><span style="color:#24292E;">    X_train_processed, y_train_processed </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> processor.prepare_data(X_train, y_train, </span><span style="color:#E36209;">build_vocab</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    X_val_processed, y_val_processed </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> processor.transform_data(X_val, y_val)</span></span>
<span class="line"><span style="color:#24292E;">    X_test_processed, y_test_processed </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> processor.transform_data(X_test, y_test)</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># åˆ›å»ºæ•°æ®é›†</span></span>
<span class="line"><span style="color:#24292E;">    train_dataset </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> SentimentDataset(X_train_processed, y_train_processed)</span></span>
<span class="line"><span style="color:#24292E;">    val_dataset </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> SentimentDataset(X_val_processed, y_val_processed)</span></span>
<span class="line"><span style="color:#24292E;">    test_dataset </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> SentimentDataset(X_test_processed, y_test_processed)</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># åˆ›å»ºæ•°æ®åŠ è½½å™¨</span></span>
<span class="line"><span style="color:#24292E;">    train_loader </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> DataLoader(train_dataset, </span><span style="color:#E36209;">batch_size</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">batch_size, </span><span style="color:#E36209;">shuffle</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    val_loader </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> DataLoader(val_dataset, </span><span style="color:#E36209;">batch_size</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">batch_size, </span><span style="color:#E36209;">shuffle</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">False</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    test_loader </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> DataLoader(test_dataset, </span><span style="color:#E36209;">batch_size</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">batch_size, </span><span style="color:#E36209;">shuffle</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">False</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> train_loader, val_loader, test_loader, processor</span></span></code></pre></div><h3 id="_2ï¸âƒ£-è¯„ä¼°æŒ‡æ ‡è®¡ç®—-å·²æä¾›å®Œæ•´å®ç°" tabindex="-1">2ï¸âƒ£ è¯„ä¼°æŒ‡æ ‡è®¡ç®—ï¼ˆå·²æä¾›å®Œæ•´å®ç°ï¼‰ <a class="header-anchor" href="#_2ï¸âƒ£-è¯„ä¼°æŒ‡æ ‡è®¡ç®—-å·²æä¾›å®Œæ•´å®ç°" aria-label="Permalink to &quot;2ï¸âƒ£ è¯„ä¼°æŒ‡æ ‡è®¡ç®—ï¼ˆå·²æä¾›å®Œæ•´å®ç°ï¼‰&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> sklearn.metrics </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> accuracy_score, precision_score, recall_score, f1_score, confusion_matrix</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> matplotlib.pyplot </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> plt</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> seaborn </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> sns</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">calculate_metrics</span><span style="color:#E1E4E8;">(y_true, y_pred, num_classes):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;è®¡ç®—æ‰€æœ‰è¯„ä¼°æŒ‡æ ‡&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    accuracy </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> accuracy_score(y_true, y_pred)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># æ ¹æ®ç±»åˆ«æ•°é‡é€‰æ‹©å¹³å‡æ–¹å¼</span></span>
<span class="line"><span style="color:#E1E4E8;">    average </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;binary&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> num_classes </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;macro&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    precision </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> precision_score(y_true, y_pred, </span><span style="color:#FFAB70;">average</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">average, </span><span style="color:#FFAB70;">zero_division</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    recall </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> recall_score(y_true, y_pred, </span><span style="color:#FFAB70;">average</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">average, </span><span style="color:#FFAB70;">zero_division</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    f1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> f1_score(y_true, y_pred, </span><span style="color:#FFAB70;">average</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">average, </span><span style="color:#FFAB70;">zero_division</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&#39;accuracy&#39;</span><span style="color:#E1E4E8;">: accuracy,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&#39;precision&#39;</span><span style="color:#E1E4E8;">: precision,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&#39;recall&#39;</span><span style="color:#E1E4E8;">: recall,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&#39;f1_score&#39;</span><span style="color:#E1E4E8;">: f1</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">plot_confusion_matrix</span><span style="color:#E1E4E8;">(y_true, y_pred, class_names</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;ç»˜åˆ¶æ··æ·†çŸ©é˜µ&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    cm </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> confusion_matrix(y_true, y_pred)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    plt.figure(</span><span style="color:#FFAB70;">figsize</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">))</span></span>
<span class="line"><span style="color:#E1E4E8;">    sns.heatmap(cm, </span><span style="color:#FFAB70;">annot</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">fmt</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;d&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">cmap</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;Blues&#39;</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#FFAB70;">xticklabels</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">class_names, </span><span style="color:#FFAB70;">yticklabels</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">class_names)</span></span>
<span class="line"><span style="color:#E1E4E8;">    plt.title(</span><span style="color:#9ECBFF;">&#39;Confusion Matrix&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    plt.ylabel(</span><span style="color:#9ECBFF;">&#39;True Label&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    plt.xlabel(</span><span style="color:#9ECBFF;">&#39;Predicted Label&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    plt.show()</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> cm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">plot_training_history</span><span style="color:#E1E4E8;">(train_losses, val_losses, train_accs, val_accs):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;ç»˜åˆ¶è®­ç»ƒå†å²&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    epochs </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">range</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">len</span><span style="color:#E1E4E8;">(train_losses) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    fig, (ax1, ax2) </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> plt.subplots(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">figsize</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">))</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># æŸå¤±æ›²çº¿</span></span>
<span class="line"><span style="color:#E1E4E8;">    ax1.plot(epochs, train_losses, </span><span style="color:#9ECBFF;">&#39;b-&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">label</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;Training Loss&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    ax1.plot(epochs, val_losses, </span><span style="color:#9ECBFF;">&#39;r-&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">label</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;Validation Loss&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    ax1.set_title(</span><span style="color:#9ECBFF;">&#39;Training and Validation Loss&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    ax1.set_xlabel(</span><span style="color:#9ECBFF;">&#39;Epochs&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    ax1.set_ylabel(</span><span style="color:#9ECBFF;">&#39;Loss&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    ax1.legend()</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># å‡†ç¡®ç‡æ›²çº¿</span></span>
<span class="line"><span style="color:#E1E4E8;">    ax2.plot(epochs, train_accs, </span><span style="color:#9ECBFF;">&#39;b-&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">label</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;Training Accuracy&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    ax2.plot(epochs, val_accs, </span><span style="color:#9ECBFF;">&#39;r-&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">label</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;Validation Accuracy&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    ax2.set_title(</span><span style="color:#9ECBFF;">&#39;Training and Validation Accuracy&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    ax2.set_xlabel(</span><span style="color:#9ECBFF;">&#39;Epochs&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    ax2.set_ylabel(</span><span style="color:#9ECBFF;">&#39;Accuracy&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    ax2.legend()</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    plt.tight_layout()</span></span>
<span class="line"><span style="color:#E1E4E8;">    plt.show()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> sklearn.metrics </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> accuracy_score, precision_score, recall_score, f1_score, confusion_matrix</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> matplotlib.pyplot </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> plt</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> seaborn </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> sns</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">calculate_metrics</span><span style="color:#24292E;">(y_true, y_pred, num_classes):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;è®¡ç®—æ‰€æœ‰è¯„ä¼°æŒ‡æ ‡&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    accuracy </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> accuracy_score(y_true, y_pred)</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># æ ¹æ®ç±»åˆ«æ•°é‡é€‰æ‹©å¹³å‡æ–¹å¼</span></span>
<span class="line"><span style="color:#24292E;">    average </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;binary&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> num_classes </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;macro&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    precision </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> precision_score(y_true, y_pred, </span><span style="color:#E36209;">average</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">average, </span><span style="color:#E36209;">zero_division</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    recall </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> recall_score(y_true, y_pred, </span><span style="color:#E36209;">average</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">average, </span><span style="color:#E36209;">zero_division</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    f1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> f1_score(y_true, y_pred, </span><span style="color:#E36209;">average</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">average, </span><span style="color:#E36209;">zero_division</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&#39;accuracy&#39;</span><span style="color:#24292E;">: accuracy,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&#39;precision&#39;</span><span style="color:#24292E;">: precision,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&#39;recall&#39;</span><span style="color:#24292E;">: recall,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&#39;f1_score&#39;</span><span style="color:#24292E;">: f1</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">plot_confusion_matrix</span><span style="color:#24292E;">(y_true, y_pred, class_names</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">None</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;ç»˜åˆ¶æ··æ·†çŸ©é˜µ&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    cm </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> confusion_matrix(y_true, y_pred)</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    plt.figure(</span><span style="color:#E36209;">figsize</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">8</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">6</span><span style="color:#24292E;">))</span></span>
<span class="line"><span style="color:#24292E;">    sns.heatmap(cm, </span><span style="color:#E36209;">annot</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">, </span><span style="color:#E36209;">fmt</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;d&#39;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">cmap</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;Blues&#39;</span><span style="color:#24292E;">, </span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#E36209;">xticklabels</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">class_names, </span><span style="color:#E36209;">yticklabels</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">class_names)</span></span>
<span class="line"><span style="color:#24292E;">    plt.title(</span><span style="color:#032F62;">&#39;Confusion Matrix&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    plt.ylabel(</span><span style="color:#032F62;">&#39;True Label&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    plt.xlabel(</span><span style="color:#032F62;">&#39;Predicted Label&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    plt.show()</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> cm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">plot_training_history</span><span style="color:#24292E;">(train_losses, val_losses, train_accs, val_accs):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;ç»˜åˆ¶è®­ç»ƒå†å²&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    epochs </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">range</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">len</span><span style="color:#24292E;">(train_losses) </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    fig, (ax1, ax2) </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> plt.subplots(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">, </span><span style="color:#E36209;">figsize</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">12</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">))</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># æŸå¤±æ›²çº¿</span></span>
<span class="line"><span style="color:#24292E;">    ax1.plot(epochs, train_losses, </span><span style="color:#032F62;">&#39;b-&#39;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">label</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;Training Loss&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    ax1.plot(epochs, val_losses, </span><span style="color:#032F62;">&#39;r-&#39;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">label</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;Validation Loss&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    ax1.set_title(</span><span style="color:#032F62;">&#39;Training and Validation Loss&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    ax1.set_xlabel(</span><span style="color:#032F62;">&#39;Epochs&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    ax1.set_ylabel(</span><span style="color:#032F62;">&#39;Loss&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    ax1.legend()</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># å‡†ç¡®ç‡æ›²çº¿</span></span>
<span class="line"><span style="color:#24292E;">    ax2.plot(epochs, train_accs, </span><span style="color:#032F62;">&#39;b-&#39;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">label</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;Training Accuracy&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    ax2.plot(epochs, val_accs, </span><span style="color:#032F62;">&#39;r-&#39;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">label</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;Validation Accuracy&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    ax2.set_title(</span><span style="color:#032F62;">&#39;Training and Validation Accuracy&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    ax2.set_xlabel(</span><span style="color:#032F62;">&#39;Epochs&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    ax2.set_ylabel(</span><span style="color:#032F62;">&#39;Accuracy&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    ax2.legend()</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    plt.tight_layout()</span></span>
<span class="line"><span style="color:#24292E;">    plt.show()</span></span></code></pre></div><hr><h2 id="ğŸ’»-ä½ çš„æ ¸å¿ƒæŒ‘æˆ˜ä»»åŠ¡" tabindex="-1">ğŸ’» ä½ çš„æ ¸å¿ƒæŒ‘æˆ˜ä»»åŠ¡ <a class="header-anchor" href="#ğŸ’»-ä½ çš„æ ¸å¿ƒæŒ‘æˆ˜ä»»åŠ¡" aria-label="Permalink to &quot;ğŸ’» ä½ çš„æ ¸å¿ƒæŒ‘æˆ˜ä»»åŠ¡&quot;">â€‹</a></h2><p>ç°åœ¨è½®åˆ°ä½ å¤§æ˜¾èº«æ‰‹äº†ï¼ä»¥ä¸‹æ˜¯éœ€è¦ä½ ç‹¬ç«‹å®Œæˆçš„æ ¸å¿ƒéƒ¨åˆ†ï¼š</p><h3 id="_3ï¸âƒ£-åŒå‘lstmæ¨¡å‹å®ç°-ğŸ§ " tabindex="-1">3ï¸âƒ£ åŒå‘LSTMæ¨¡å‹å®ç° ğŸ§  <a class="header-anchor" href="#_3ï¸âƒ£-åŒå‘lstmæ¨¡å‹å®ç°-ğŸ§ " aria-label="Permalink to &quot;3ï¸âƒ£ åŒå‘LSTMæ¨¡å‹å®ç° ğŸ§ &quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> torch</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> torch.nn </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> nn</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">BiLSTMClassifier</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">nn</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">Module</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">__init__</span><span style="color:#E1E4E8;">(self, vocab_size, embed_dim, hidden_dim, num_layers, num_classes, dropout</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0.3</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">super</span><span style="color:#E1E4E8;">(BiLSTMClassifier, </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">).</span><span style="color:#79B8FF;">__init__</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># </span><span style="color:#F97583;">TODO</span><span style="color:#6A737D;">: å®šä¹‰æ¨¡å‹å±‚</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># æŒ‘æˆ˜æç¤ºï¼š</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># - åµŒå…¥å±‚ï¼šå°†è¯æ±‡IDè½¬æ¢ä¸ºå‘é‡è¡¨ç¤º</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># - åŒå‘LSTMå±‚ï¼šæ•æ‰åºåˆ—çš„å‰å‘å’Œåå‘ä¿¡æ¯</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># - å…¨è¿æ¥å±‚ï¼šè¿›è¡Œæœ€ç»ˆåˆ†ç±»</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># - Dropoutå±‚ï¼šé˜²æ­¢è¿‡æ‹Ÿåˆ</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">pass</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">forward</span><span style="color:#E1E4E8;">(self, x):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">        å‰å‘ä¼ æ’­</span></span>
<span class="line"><span style="color:#9ECBFF;">        x: [batch_size, seq_len]</span></span>
<span class="line"><span style="color:#9ECBFF;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># </span><span style="color:#F97583;">TODO</span><span style="color:#6A737D;">: å®ç°å‰å‘ä¼ æ’­</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># æ€è€ƒï¼š</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># - å¦‚ä½•å¤„ç†åŒå‘LSTMçš„è¾“å‡ºï¼Ÿ</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># - å¦‚ä½•å°†åºåˆ—ä¿¡æ¯è½¬æ¢ä¸ºåˆ†ç±»ç»“æœï¼Ÿ</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">pass</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> torch</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> torch.nn </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> nn</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BiLSTMClassifier</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">nn</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">Module</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">__init__</span><span style="color:#24292E;">(self, vocab_size, embed_dim, hidden_dim, num_layers, num_classes, dropout</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0.3</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">super</span><span style="color:#24292E;">(BiLSTMClassifier, </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">).</span><span style="color:#005CC5;">__init__</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># </span><span style="color:#D73A49;">TODO</span><span style="color:#6A737D;">: å®šä¹‰æ¨¡å‹å±‚</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># æŒ‘æˆ˜æç¤ºï¼š</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># - åµŒå…¥å±‚ï¼šå°†è¯æ±‡IDè½¬æ¢ä¸ºå‘é‡è¡¨ç¤º</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># - åŒå‘LSTMå±‚ï¼šæ•æ‰åºåˆ—çš„å‰å‘å’Œåå‘ä¿¡æ¯</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># - å…¨è¿æ¥å±‚ï¼šè¿›è¡Œæœ€ç»ˆåˆ†ç±»</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># - Dropoutå±‚ï¼šé˜²æ­¢è¿‡æ‹Ÿåˆ</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">pass</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">forward</span><span style="color:#24292E;">(self, x):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#032F62;">        å‰å‘ä¼ æ’­</span></span>
<span class="line"><span style="color:#032F62;">        x: [batch_size, seq_len]</span></span>
<span class="line"><span style="color:#032F62;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># </span><span style="color:#D73A49;">TODO</span><span style="color:#6A737D;">: å®ç°å‰å‘ä¼ æ’­</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># æ€è€ƒï¼š</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># - å¦‚ä½•å¤„ç†åŒå‘LSTMçš„è¾“å‡ºï¼Ÿ</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># - å¦‚ä½•å°†åºåˆ—ä¿¡æ¯è½¬æ¢ä¸ºåˆ†ç±»ç»“æœï¼Ÿ</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">pass</span></span></code></pre></div><h3 id="_4ï¸âƒ£-è®­ç»ƒå™¨å®ç°-ğŸš‚" tabindex="-1">4ï¸âƒ£ è®­ç»ƒå™¨å®ç° ğŸš‚ <a class="header-anchor" href="#_4ï¸âƒ£-è®­ç»ƒå™¨å®ç°-ğŸš‚" aria-label="Permalink to &quot;4ï¸âƒ£ è®­ç»ƒå™¨å®ç° ğŸš‚&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SentimentTrainer</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">__init__</span><span style="color:#E1E4E8;">(self, model, device</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;cuda&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> torch.cuda.is_available() </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;cpu&#39;</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.model </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> model.to(device)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.device </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> device</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># </span><span style="color:#F97583;">TODO</span><span style="color:#6A737D;">: åˆå§‹åŒ–ä¼˜åŒ–å™¨å’ŒæŸå¤±å‡½æ•°</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># ğŸ’¡ æç¤ºï¼šè€ƒè™‘ä½¿ç”¨Adamä¼˜åŒ–å™¨å’Œäº¤å‰ç†µæŸå¤±</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">pass</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">train_epoch</span><span style="color:#E1E4E8;">(self, train_loader):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;&quot;&quot;è®­ç»ƒä¸€ä¸ªepoch&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.model.train()</span></span>
<span class="line"><span style="color:#E1E4E8;">        total_loss </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">        correct </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">        total </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># </span><span style="color:#F97583;">TODO</span><span style="color:#6A737D;">: å®ç°è®­ç»ƒå¾ªç¯</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># æ ¸å¿ƒæ­¥éª¤ï¼š</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 1. éå†æ‰¹æ¬¡æ•°æ®</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 2. å‰å‘ä¼ æ’­</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 3. è®¡ç®—æŸå¤±</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 4. åå‘ä¼ æ’­</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 5. å‚æ•°æ›´æ–°</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 6. ç»Ÿè®¡å‡†ç¡®ç‡</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">pass</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> total_loss </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">len</span><span style="color:#E1E4E8;">(train_loader), correct </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> total</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">evaluate</span><span style="color:#E1E4E8;">(self, data_loader):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;&quot;&quot;è¯„ä¼°æ¨¡å‹&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.model.eval()</span></span>
<span class="line"><span style="color:#E1E4E8;">        total_loss </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">        all_predictions </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> []</span></span>
<span class="line"><span style="color:#E1E4E8;">        all_labels </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> []</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> torch.no_grad():</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;"># </span><span style="color:#F97583;">TODO</span><span style="color:#6A737D;">: å®ç°è¯„ä¼°å¾ªç¯</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;"># æ ¸å¿ƒä»»åŠ¡ï¼š</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;"># 1. éå†éªŒè¯æ•°æ®</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;"># 2. å‰å‘ä¼ æ’­ï¼ˆæ— æ¢¯åº¦è®¡ç®—ï¼‰</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;"># 3. æ”¶é›†é¢„æµ‹ç»“æœå’ŒçœŸå®æ ‡ç­¾</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">pass</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> total_loss </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">len</span><span style="color:#E1E4E8;">(data_loader), all_predictions, all_labels</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">train</span><span style="color:#E1E4E8;">(self, train_loader, val_loader, num_epochs</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;&quot;&quot;å®Œæ•´è®­ç»ƒæµç¨‹&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        train_losses, val_losses </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [], []</span></span>
<span class="line"><span style="color:#E1E4E8;">        train_accs, val_accs </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [], []</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># </span><span style="color:#F97583;">TODO</span><span style="color:#6A737D;">: å®ç°å®Œæ•´è®­ç»ƒå¾ªç¯</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># å®Œæ•´æµç¨‹ï¼š</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 1. å¾ªç¯è®­ç»ƒå¤šä¸ªepoch</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 2. æ¯ä¸ªepochåè¿›è¡ŒéªŒè¯</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 3. è®°å½•è®­ç»ƒå†å²</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 4. å¯é€‰ï¼šå®ç°æ—©åœæœºåˆ¶</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">pass</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> train_losses, val_losses, train_accs, val_accs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SentimentTrainer</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">__init__</span><span style="color:#24292E;">(self, model, device</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;cuda&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> torch.cuda.is_available() </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;cpu&#39;</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.model </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> model.to(device)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.device </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> device</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># </span><span style="color:#D73A49;">TODO</span><span style="color:#6A737D;">: åˆå§‹åŒ–ä¼˜åŒ–å™¨å’ŒæŸå¤±å‡½æ•°</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># ğŸ’¡ æç¤ºï¼šè€ƒè™‘ä½¿ç”¨Adamä¼˜åŒ–å™¨å’Œäº¤å‰ç†µæŸå¤±</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">pass</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">train_epoch</span><span style="color:#24292E;">(self, train_loader):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;&quot;&quot;è®­ç»ƒä¸€ä¸ªepoch&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.model.train()</span></span>
<span class="line"><span style="color:#24292E;">        total_loss </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">        correct </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">        total </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># </span><span style="color:#D73A49;">TODO</span><span style="color:#6A737D;">: å®ç°è®­ç»ƒå¾ªç¯</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># æ ¸å¿ƒæ­¥éª¤ï¼š</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 1. éå†æ‰¹æ¬¡æ•°æ®</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 2. å‰å‘ä¼ æ’­</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 3. è®¡ç®—æŸå¤±</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 4. åå‘ä¼ æ’­</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 5. å‚æ•°æ›´æ–°</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 6. ç»Ÿè®¡å‡†ç¡®ç‡</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">pass</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> total_loss </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">len</span><span style="color:#24292E;">(train_loader), correct </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> total</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">evaluate</span><span style="color:#24292E;">(self, data_loader):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;&quot;&quot;è¯„ä¼°æ¨¡å‹&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.model.eval()</span></span>
<span class="line"><span style="color:#24292E;">        total_loss </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">        all_predictions </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> []</span></span>
<span class="line"><span style="color:#24292E;">        all_labels </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> []</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> torch.no_grad():</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;"># </span><span style="color:#D73A49;">TODO</span><span style="color:#6A737D;">: å®ç°è¯„ä¼°å¾ªç¯</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;"># æ ¸å¿ƒä»»åŠ¡ï¼š</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;"># 1. éå†éªŒè¯æ•°æ®</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;"># 2. å‰å‘ä¼ æ’­ï¼ˆæ— æ¢¯åº¦è®¡ç®—ï¼‰</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;"># 3. æ”¶é›†é¢„æµ‹ç»“æœå’ŒçœŸå®æ ‡ç­¾</span></span>
<span class="line"><span style="color:#24292E;">            </span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">pass</span></span>
<span class="line"><span style="color:#24292E;">            </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> total_loss </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">len</span><span style="color:#24292E;">(data_loader), all_predictions, all_labels</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">train</span><span style="color:#24292E;">(self, train_loader, val_loader, num_epochs</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;&quot;&quot;å®Œæ•´è®­ç»ƒæµç¨‹&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        train_losses, val_losses </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [], []</span></span>
<span class="line"><span style="color:#24292E;">        train_accs, val_accs </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [], []</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># </span><span style="color:#D73A49;">TODO</span><span style="color:#6A737D;">: å®ç°å®Œæ•´è®­ç»ƒå¾ªç¯</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># å®Œæ•´æµç¨‹ï¼š</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 1. å¾ªç¯è®­ç»ƒå¤šä¸ªepoch</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 2. æ¯ä¸ªepochåè¿›è¡ŒéªŒè¯</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 3. è®°å½•è®­ç»ƒå†å²</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 4. å¯é€‰ï¼šå®ç°æ—©åœæœºåˆ¶</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">pass</span></span>
<span class="line"><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> train_losses, val_losses, train_accs, val_accs</span></span></code></pre></div><h3 id="_5ï¸âƒ£-ä¸»å‡½æ•°å®Œå–„-ğŸ®" tabindex="-1">5ï¸âƒ£ ä¸»å‡½æ•°å®Œå–„ ğŸ® <a class="header-anchor" href="#_5ï¸âƒ£-ä¸»å‡½æ•°å®Œå–„-ğŸ®" aria-label="Permalink to &quot;5ï¸âƒ£ ä¸»å‡½æ•°å®Œå–„ ğŸ®&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">():</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># åŠ è½½æ•°æ®</span></span>
<span class="line"><span style="color:#E1E4E8;">    file_path </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;your_dataset.csv&quot;</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># æ›¿æ¢ä¸ºå®é™…è·¯å¾„</span></span>
<span class="line"><span style="color:#E1E4E8;">    texts, labels </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> load_and_prepare_data(file_path)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># åˆ›å»ºæ•°æ®åŠ è½½å™¨</span></span>
<span class="line"><span style="color:#E1E4E8;">    train_loader, val_loader, test_loader, processor </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> create_data_loaders(texts, labels)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># </span><span style="color:#F97583;">TODO</span><span style="color:#6A737D;">: åˆ›å»ºæ¨¡å‹</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># å‚æ•°è®¾è®¡æç¤ºï¼š</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># - vocab_size: len(processor.word2idx)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># - embed_dim: å°è¯•128æˆ–256</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># - hidden_dim: å°è¯•128æˆ–256</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># - num_layers: ä»1å¼€å§‹å°è¯•</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># - num_classes: æ ¹æ®æ•°æ®é›†çš„ç±»åˆ«æ•°ç¡®å®š</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># </span><span style="color:#F97583;">TODO</span><span style="color:#6A737D;">: åˆ›å»ºè®­ç»ƒå™¨å¹¶è®­ç»ƒ</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># è®­ç»ƒç­–ç•¥ï¼š</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># - é€‰æ‹©åˆé€‚çš„epochæ•°é‡</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># - è§‚å¯Ÿè®­ç»ƒæ›²çº¿</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># - è°ƒæ•´å­¦ä¹ ç‡</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># </span><span style="color:#F97583;">TODO</span><span style="color:#6A737D;">: æµ‹è¯•æ¨¡å‹</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># æœ€ç»ˆè¯„ä¼°ï¼š</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># - åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># - è®¡ç®—å„é¡¹æŒ‡æ ‡</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># - åˆ†æç»“æœ</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># æ˜¾ç¤ºç»“æœ</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">print</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;æµ‹è¯•é›†ç»“æœ:&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> metric, value </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> test_metrics.items():</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">print</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">f</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#79B8FF;">{</span><span style="color:#E1E4E8;">metric</span><span style="color:#79B8FF;">}</span><span style="color:#9ECBFF;">: </span><span style="color:#79B8FF;">{</span><span style="color:#E1E4E8;">value</span><span style="color:#F97583;">:.4f</span><span style="color:#79B8FF;">}</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># ç»˜åˆ¶è®­ç»ƒæ›²çº¿å’Œæ··æ·†çŸ©é˜µ</span></span>
<span class="line"><span style="color:#E1E4E8;">    plot_training_history(train_losses, val_losses, train_accs, val_accs)</span></span>
<span class="line"><span style="color:#E1E4E8;">    plot_confusion_matrix(test_labels, test_predictions)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">():</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># åŠ è½½æ•°æ®</span></span>
<span class="line"><span style="color:#24292E;">    file_path </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;your_dataset.csv&quot;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># æ›¿æ¢ä¸ºå®é™…è·¯å¾„</span></span>
<span class="line"><span style="color:#24292E;">    texts, labels </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> load_and_prepare_data(file_path)</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># åˆ›å»ºæ•°æ®åŠ è½½å™¨</span></span>
<span class="line"><span style="color:#24292E;">    train_loader, val_loader, test_loader, processor </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> create_data_loaders(texts, labels)</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># </span><span style="color:#D73A49;">TODO</span><span style="color:#6A737D;">: åˆ›å»ºæ¨¡å‹</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># å‚æ•°è®¾è®¡æç¤ºï¼š</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># - vocab_size: len(processor.word2idx)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># - embed_dim: å°è¯•128æˆ–256</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># - hidden_dim: å°è¯•128æˆ–256</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># - num_layers: ä»1å¼€å§‹å°è¯•</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># - num_classes: æ ¹æ®æ•°æ®é›†çš„ç±»åˆ«æ•°ç¡®å®š</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># </span><span style="color:#D73A49;">TODO</span><span style="color:#6A737D;">: åˆ›å»ºè®­ç»ƒå™¨å¹¶è®­ç»ƒ</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># è®­ç»ƒç­–ç•¥ï¼š</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># - é€‰æ‹©åˆé€‚çš„epochæ•°é‡</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># - è§‚å¯Ÿè®­ç»ƒæ›²çº¿</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># - è°ƒæ•´å­¦ä¹ ç‡</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># </span><span style="color:#D73A49;">TODO</span><span style="color:#6A737D;">: æµ‹è¯•æ¨¡å‹</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># æœ€ç»ˆè¯„ä¼°ï¼š</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># - åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># - è®¡ç®—å„é¡¹æŒ‡æ ‡</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># - åˆ†æç»“æœ</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># æ˜¾ç¤ºç»“æœ</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;æµ‹è¯•é›†ç»“æœ:&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> metric, value </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> test_metrics.items():</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">f</span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">{</span><span style="color:#24292E;">metric</span><span style="color:#005CC5;">}</span><span style="color:#032F62;">: </span><span style="color:#005CC5;">{</span><span style="color:#24292E;">value</span><span style="color:#D73A49;">:.4f</span><span style="color:#005CC5;">}</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># ç»˜åˆ¶è®­ç»ƒæ›²çº¿å’Œæ··æ·†çŸ©é˜µ</span></span>
<span class="line"><span style="color:#24292E;">    plot_training_history(train_losses, val_losses, train_accs, val_accs)</span></span>
<span class="line"><span style="color:#24292E;">    plot_confusion_matrix(test_labels, test_predictions)</span></span></code></pre></div><blockquote><p><strong>ç¼–ç¨‹å»ºè®®</strong>ï¼šå…ˆå®ç°åŸºæœ¬åŠŸèƒ½ï¼Œå†é€æ­¥ä¼˜åŒ–ã€‚è®°ä½ï¼Œè°ƒè¯•æ˜¯ç¼–ç¨‹çš„è‰ºæœ¯ï¼</p></blockquote><hr><h2 id="ğŸš€-æ€§èƒ½æå‡æŒ‘æˆ˜" tabindex="-1">ğŸš€ æ€§èƒ½æå‡æŒ‘æˆ˜ <a class="header-anchor" href="#ğŸš€-æ€§èƒ½æå‡æŒ‘æˆ˜" aria-label="Permalink to &quot;ğŸš€ æ€§èƒ½æå‡æŒ‘æˆ˜&quot;">â€‹</a></h2><p>åŸºç¡€æ¨¡å‹å®Œæˆåï¼Œæ˜¯æ—¶å€™é‡Šæ”¾ä½ çš„åˆ›é€ åŠ›äº†ï¼å°è¯•ä»¥ä¸‹æ”¹è¿›ç­–ç•¥ï¼š</p><h3 id="æ¨¡å‹æ¶æ„ä¼˜åŒ–" tabindex="-1">æ¨¡å‹æ¶æ„ä¼˜åŒ– <a class="header-anchor" href="#æ¨¡å‹æ¶æ„ä¼˜åŒ–" aria-label="Permalink to &quot;æ¨¡å‹æ¶æ„ä¼˜åŒ–&quot;">â€‹</a></h3><ul><li><strong>æ¶æ„æ¢ç´¢</strong>ï¼šå°è¯•GRUæ›¿ä»£LSTMï¼Œæˆ–å¢åŠ LSTMå±‚æ•°</li><li><strong>æ®‹å·®è¿æ¥</strong>ï¼šæ¢ç´¢æ›´æ·±å±‚çš„ç½‘ç»œç»“æ„</li></ul><h3 id="è®­ç»ƒç­–ç•¥å‡çº§" tabindex="-1">è®­ç»ƒç­–ç•¥å‡çº§ <a class="header-anchor" href="#è®­ç»ƒç­–ç•¥å‡çº§" aria-label="Permalink to &quot;è®­ç»ƒç­–ç•¥å‡çº§&quot;">â€‹</a></h3><ul><li><strong>å­¦ä¹ ç‡è°ƒåº¦</strong>ï¼šå®ç°å­¦ä¹ ç‡è¡°å‡æˆ–å¾ªç¯å­¦ä¹ ç‡</li><li><strong>æ­£åˆ™åŒ–æŠ€æœ¯</strong>ï¼šæ‰¹å½’ä¸€åŒ–ã€æƒé‡è¡°å‡ç­‰</li></ul><h3 id="è¶…å‚æ•°ç²¾è°ƒ" tabindex="-1">è¶…å‚æ•°ç²¾è°ƒ <a class="header-anchor" href="#è¶…å‚æ•°ç²¾è°ƒ" aria-label="Permalink to &quot;è¶…å‚æ•°ç²¾è°ƒ&quot;">â€‹</a></h3><ul><li><strong>åµŒå…¥ç»´åº¦</strong>ï¼šå°è¯•ä¸åŒçš„embeddingç»´åº¦</li><li><strong>éšè—å±‚å¤§å°</strong>ï¼šæ¢ç´¢æœ€é€‚åˆçš„hidden size</li><li><strong>Dropoutæ¯”ä¾‹</strong>ï¼šæ‰¾åˆ°è¿‡æ‹Ÿåˆä¸æ¬ æ‹Ÿåˆçš„å¹³è¡¡ç‚¹</li><li><strong>æ‰¹æ¬¡å¤§å°</strong>ï¼šä¼˜åŒ–è®­ç»ƒæ•ˆç‡</li></ul><blockquote><p>ğŸ’¡ <strong>ä¼˜åŒ–æç¤º</strong>ï¼šè¿™ä¸ªé˜¶æ®µå¯ä»¥å……åˆ†åˆ©ç”¨AIå·¥å…·æ¥æ¢ç´¢æ›´å…ˆè¿›çš„æŠ€æœ¯å’Œæ–¹æ³•ï¼</p></blockquote><hr><h2 id="ğŸ“-å®éªŒæŠ¥å‘Šæ’°å†™æŒ‡å—" tabindex="-1">ğŸ“ å®éªŒæŠ¥å‘Šæ’°å†™æŒ‡å— <a class="header-anchor" href="#ğŸ“-å®éªŒæŠ¥å‘Šæ’°å†™æŒ‡å—" aria-label="Permalink to &quot;ğŸ“ å®éªŒæŠ¥å‘Šæ’°å†™æŒ‡å—&quot;">â€‹</a></h2><p>ä½ çš„å®éªŒæŠ¥å‘Šå°†å±•ç°ä½ çš„å®Œæ•´é¡¹ç›®ç»å†ï¼Œå»ºè®®åŒ…å«ä»¥ä¸‹ç²¾å½©å†…å®¹ï¼š</p><h3 id="_1-æ¨¡å‹å®ç°ç¯‡" tabindex="-1"><strong>1. æ¨¡å‹å®ç°ç¯‡</strong> <a class="header-anchor" href="#_1-æ¨¡å‹å®ç°ç¯‡" aria-label="Permalink to &quot;**1. æ¨¡å‹å®ç°ç¯‡**&quot;">â€‹</a></h3><ul><li>åŒå‘LSTMæ¨¡å‹çš„å…·ä½“å®ç°ç»†èŠ‚</li><li>å…³é”®è®¾è®¡å†³ç­–çš„æ·±å…¥è§£é‡Š</li><li>é‡åˆ°çš„æŠ€æœ¯éš¾ç‚¹åŠåˆ›æ–°è§£å†³æ–¹æ¡ˆ</li></ul><h3 id="_2-è®­ç»ƒè¿‡ç¨‹ç¯‡" tabindex="-1"><strong>2. è®­ç»ƒè¿‡ç¨‹ç¯‡</strong> <a class="header-anchor" href="#_2-è®­ç»ƒè¿‡ç¨‹ç¯‡" aria-label="Permalink to &quot;**2. è®­ç»ƒè¿‡ç¨‹ç¯‡**&quot;">â€‹</a></h3><ul><li>è®­ç»ƒæµç¨‹çš„å®Œæ•´å®ç°</li><li>è¶…å‚æ•°é€‰æ‹©çš„æ€è€ƒè¿‡ç¨‹å’Œè°ƒä¼˜å†ç¨‹</li><li>è®­ç»ƒä¸­çš„æœ‰è¶£å‘ç°å’Œç°è±¡è§‚å¯Ÿ</li></ul><h3 id="_3-æ”¹è¿›ç­–ç•¥ç¯‡" tabindex="-1"><strong>3. æ”¹è¿›ç­–ç•¥ç¯‡</strong> <a class="header-anchor" href="#_3-æ”¹è¿›ç­–ç•¥ç¯‡" aria-label="Permalink to &quot;**3. æ”¹è¿›ç­–ç•¥ç¯‡**&quot;">â€‹</a></h3><ul><li>å°è¯•çš„å„ç§æ”¹è¿›æ–¹æ³•å’Œå®éªŒè®¾è®¡</li><li>æ¯ç§æ–¹æ³•çš„æ•ˆæœåˆ†æå’Œæ€§èƒ½å¯¹æ¯”</li><li>æœ€ç»ˆè¾¾åˆ°çš„æ€§èƒ½æŒ‡æ ‡å’Œçªç ´è¿‡ç¨‹</li></ul><h3 id="_4-æ”¶è·ä¸æ€è€ƒç¯‡" tabindex="-1"><strong>4. æ”¶è·ä¸æ€è€ƒç¯‡</strong> <a class="header-anchor" href="#_4-æ”¶è·ä¸æ€è€ƒç¯‡" aria-label="Permalink to &quot;**4. æ”¶è·ä¸æ€è€ƒç¯‡**&quot;">â€‹</a></h3><ul><li>å¯¹RNNå’ŒLSTMçš„æ·±å±‚ç†è§£å’Œæ–°è®¤è¯†</li><li>é¡¹ç›®ä¸­ç§¯ç´¯çš„å®è´µç»éªŒå’ŒæŠ€èƒ½</li><li>é‡åˆ°çš„æŒ‘æˆ˜å’Œåˆ›é€ æ€§è§£å†³æ€è·¯</li><li>å¯¹æ·±åº¦å­¦ä¹ é¢†åŸŸçš„å‰ç»æ€§æ€è€ƒ</li></ul><blockquote><p><strong>æŠ¥å‘Šæç¤º</strong>ï¼šç”¨ä½ è‡ªå·±çš„è¯­è¨€æ¥æè¿°è¿™ä¸ªé¡¹ç›®ï¼åˆ†äº«ä½ çš„æ€è€ƒè¿‡ç¨‹ã€é‡åˆ°çš„å›°éš¾ä»¥åŠè§£å†³é—®é¢˜æ—¶çš„æˆå°±æ„Ÿã€‚</p></blockquote><h2 id="ğŸŒŸ-é¡¹ç›®å¯„è¯­" tabindex="-1">ğŸŒŸ é¡¹ç›®å¯„è¯­ <a class="header-anchor" href="#ğŸŒŸ-é¡¹ç›®å¯„è¯­" aria-label="Permalink to &quot;ğŸŒŸ é¡¹ç›®å¯„è¯­&quot;">â€‹</a></h2><p>æ­å–œä½ å³å°†å®Œæˆä¸€ä¸ªå®Œæ•´çš„æ·±åº¦å­¦ä¹ é¡¹ç›®ï¼ğŸŠ ä»æ•°æ®å¤„ç†åˆ°æ¨¡å‹æ„å»ºï¼Œä»è®­ç»ƒä¼˜åŒ–åˆ°æ€§èƒ½è¯„ä¼°ï¼Œä½ å°†ä½“éªŒåˆ°AIå·¥ç¨‹å¸ˆçš„å®Œæ•´å·¥ä½œæµç¨‹ã€‚</p><p>è¿™ä¸ªæƒ…æ„Ÿåˆ†æç³»ç»Ÿä¸ä»…ä»…æ˜¯ä¸€ä¸ªä½œä¸šé¡¹ç›®ï¼Œå®ƒä»£è¡¨ç€ä½ åœ¨AIé“è·¯ä¸Šçš„é‡è¦é‡Œç¨‹ç¢‘ã€‚é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œä½ å°†ï¼š</p><ul><li>ğŸ§  <strong>æ·±åº¦ç†è§£</strong>RNN/LSTMçš„å·¥ä½œåŸç†</li><li>ğŸ’» <strong>æŒæ¡å®æˆ˜</strong>æ·±åº¦å­¦ä¹ é¡¹ç›®çš„å®Œæ•´æµç¨‹</li><li>ğŸš€ <strong>ä½“éªŒåˆ›æ–°</strong>æ¨¡å‹ä¼˜åŒ–çš„ä¹è¶£</li><li>ğŸ“Š <strong>å­¦ä¼šè¯„ä¼°</strong>AIç³»ç»Ÿçš„æ€§èƒ½</li></ul><p>è®°ä½ï¼Œæ¯ä¸€è¡Œä½ äº²æ‰‹å†™ä¸‹çš„ä»£ç ï¼Œæ¯ä¸€ä¸ªä½ ç‹¬ç«‹è§£å†³çš„é—®é¢˜ï¼Œéƒ½åœ¨ä¸ºä½ çš„AIå·¥ç¨‹å¸ˆä¹‹è·¯æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚</p><p><strong>ç›¸ä¿¡è‡ªå·±ï¼Œä½ æ­£åœ¨åˆ›é€ æ™ºèƒ½ï¼</strong> ğŸŒŸâœ¨</p><p>åŠ æ²¹ï¼Œæœªæ¥çš„AIä¸“å®¶ï¼ä½ çš„æƒ…æ„Ÿåˆ†æç³»ç»Ÿå°†ä¼šæ˜¯ä½ AIä¹‹è·¯ä¸Šçš„ç¬¬ä¸€ä¸ªæ°ä½œï¼ğŸ¨ğŸ¤–</p><h2 id="âš ï¸-é‡è¦æé†’" tabindex="-1">âš ï¸ é‡è¦æé†’ <a class="header-anchor" href="#âš ï¸-é‡è¦æé†’" aria-label="Permalink to &quot;âš ï¸ é‡è¦æé†’&quot;">â€‹</a></h2><h3 id="ğŸ¤-å…³äºaiå·¥å…·çš„åˆç†ä½¿ç”¨" tabindex="-1">ğŸ¤ å…³äºAIå·¥å…·çš„åˆç†ä½¿ç”¨ <a class="header-anchor" href="#ğŸ¤-å…³äºaiå·¥å…·çš„åˆç†ä½¿ç”¨" aria-label="Permalink to &quot;ğŸ¤ å…³äºAIå·¥å…·çš„åˆç†ä½¿ç”¨&quot;">â€‹</a></h3><ul><li><strong>é¼“åŠ±ç‹¬ç«‹æ€è€ƒ</strong>ï¼šæ ¸å¿ƒæ¨¡å‹å®ç°å’Œè®­ç»ƒå¾ªç¯è¯·ç‹¬ç«‹å®Œæˆ</li><li><strong>é€‚åº¦å€ŸåŠ©AI</strong>ï¼šåœ¨æ€§èƒ½ä¼˜åŒ–é˜¶æ®µå¯ä»¥ä½¿ç”¨AIå·¥å…·æ¢ç´¢è§£å†³æ–¹æ¡ˆ</li><li><strong>é¢è¯•å‡†å¤‡</strong>ï¼šç¡®ä¿è‡ªå·±èƒ½å¤Ÿæ¸…æ™°è§£é‡Šæ¯ä¸€è¡Œä»£ç çš„ä½œç”¨å’ŒåŸç†</li><li><strong>å­¦ä¹ ç›®æ ‡</strong>ï¼šé€šè¿‡ç‹¬ç«‹å®ç°åŠ æ·±ç†è§£ï¼Œé€šè¿‡å·¥å…·ä½¿ç”¨æå‡æ•ˆç‡</li></ul><hr><h2 id="æäº¤è¦æ±‚" tabindex="-1">æäº¤è¦æ±‚ <a class="header-anchor" href="#æäº¤è¦æ±‚" aria-label="Permalink to &quot;æäº¤è¦æ±‚&quot;">â€‹</a></h2><h3 id="æäº¤å†…å®¹æ¸…å•" tabindex="-1"><strong>æäº¤å†…å®¹æ¸…å•</strong> <a class="header-anchor" href="#æäº¤å†…å®¹æ¸…å•" aria-label="Permalink to &quot;**æäº¤å†…å®¹æ¸…å•**&quot;">â€‹</a></h3><ul><li><p><strong>ä»£ç æ–‡ä»¶</strong></p><p>ï¼šå®Œæ•´çš„.pyå®ç°æ–‡ä»¶ï¼Œå‘½åæ ¼å¼ï¼š<code>ml-7-å§“å-å­¦å·.py</code></p></li><li><p><strong>å®éªŒæŠ¥å‘Š</strong></p><p>ï¼šè¯¦ç»†çš„.mdæŠ¥å‘Šæ–‡ä»¶ï¼Œå‘½åæ ¼å¼ï¼š<code>ml-7-å§“å-å­¦å·.md</code></p></li><li><p>å°†ä¸¤ä¸ªæ–‡ä»¶å‹ç¼©ä¸ºä¸€ä¸ªå‹ç¼©åŒ…</p></li></ul><h3 id="æäº¤æ–¹å¼" tabindex="-1">æäº¤æ–¹å¼ <a class="header-anchor" href="#æäº¤æ–¹å¼" aria-label="Permalink to &quot;æäº¤æ–¹å¼&quot;">â€‹</a></h3><ul><li><p><strong>é‚®ç®±</strong>: <code>gimmerml401@163.com</code></p></li><li><p><strong>ä¸»é¢˜</strong>: <code>7-å§“å-å­¦å·</code></p></li></ul><blockquote><p>å‡ºé¢˜äººï¼šPluto.</p><p>QQï¼š1183452142</p></blockquote>`,78),t=[e];function c(r,E,y,i,F,_){return a(),l("div",null,t)}const D=n(o,[["render",c]]);export{A as __pageData,D as default};
